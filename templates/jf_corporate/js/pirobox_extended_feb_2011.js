(function(a){a.piroBox_ext=function(f){f=jQuery.extend({piro_speed:700,bg_alpha:0.9,piro_scroll:true,piro_drag:null,piro_nav_pos:"top"},f);a.fn.piroFadeIn=function(i,r){a(this).fadeIn(i,function(){if(jQuery.browser.msie){a(this).get(0).style.removeAttribute("filter")}if(r!=undefined){r()}})};a.fn.piroFadeOut=function(i,r){a(this).fadeOut(i,function(){if(jQuery.browser.msie){a(this).get(0).style.removeAttribute("filter")}if(r!=undefined){r()}})};var n=a('a[class*="pirobox"]');var c=new Object();for(var k=0;k<n.length;k++){var j=a(n[k]);c["a."+j.attr("class").match(/^pirobox_gall\w*/)]=0}var d=new Array();for(var p in c){d.push(p)}for(var k=0;k<d.length;k++){a(d[k]+":first").addClass("first");a(d[k]+":last").addClass("last")}var o=a(n);a('a[class*="pirobox_gall"]').each(function(i){this.rev=i+0});if(a('a[class*="pirobox_gall"]').length==1){a('a[class*="pirobox_gall"]').each(function(){a(this).addClass("single_fix")})}else{}var m='<div class="caption"></div>';var q=0.9;var h=('<div class="piro_overlay"></div><table class="piro_html"  cellpadding="0" cellspacing="0"><tr><td class="h_t_l"></td><td class="h_t_c" title="drag me!!"></td><td class="h_t_r"></td></tr><tr><td class="h_c_l"></td><td class="h_c_c"><div class="piro_loader" title="close"><span></span></div><div class="resize"><div class="nav_container"><a href="#prev" class="piro_prev" title="previous"></a><a href="#next" class="piro_next" title="next"></a><div class="piro_prev_fake">prev</div><div class="piro_next_fake">next</div><div class="piro_close" title="close"></div></div><div class="div_reg"></div></div></td><td class="h_c_r"></td></tr><tr><td class="h_b_l"></td><td class="h_b_c"></td><td class="h_b_r"></td></tr></table>');a("body").append(h);var b=a(".piro_html");piro_bg=a(".piro_overlay"),piro_nav=a(".nav_container"),piro_next=a(".piro_next"),piro_prev=a(".piro_prev"),piro_next_fake=a(".piro_next_fake"),piro_prev_fake=a(".piro_prev_fake"),piro_close=a(".piro_close"),div_reg=a(".div_reg"),piro_loader=a(".piro_loader"),resize=a(".resize"),y=a(window).height(),x=a(window).width();piro_nav.hide().css(f.piro_nav_pos,"-38px");if(f.piro_nav_pos=="top"){var l=+5}else{if(f.piro_nav_pos=="bottom"){var l=-30}}b.css({left:((x/2)-(250))+"px",top:parseInt(a(document).scrollTop())+(100)});a(b).add(piro_bg).hide();piro_bg.css({opacity:f.bg_alpha});a(piro_prev).add(piro_next).bind("click",function(s){piro_nav.hide();a(".caption").remove();a(".zoomIn").add(".zoomOut").remove();s.preventDefault();piro_next.add(piro_prev).hide();var i=parseInt(a('a[class*="pirobox_gall"]').filter(".item").attr("rev"));var r=a(this).is(".piro_prev")?a('a[class*="pirobox_gall"]').eq(i-1):a('a[class*="pirobox_gall"]').eq(i+1);r.click()});a("html").bind("keyup",function(i){if(i.keyCode==27){i.preventDefault();if(a(piro_close).is(":visible")){e()}}});a("html").bind("keyup",function(i){if(a(".item").is(".first")){}else{if(a(".item").attr("rel")=="single"){piro_nav.show()}else{if(i.keyCode==37){i.preventDefault();if(a(piro_close).is(":visible")){piro_prev.click()}}}}});a("html").bind("keyup",function(i){if(a(".item").is(".last")){}else{if(a(".item").attr("rel")=="single"){piro_nav.show()}else{if(i.keyCode==39){i.preventDefault();if(a(piro_close).is(":visible")){piro_next.click()}}}}});a(window).resize(function(){var i=a(window).height(),r=a(window).width(),t=b.height(),s=b.width();b.css({left:((r/2)-(s/2))+"px",top:parseInt(a(document).scrollTop())+(i-t)/2+l})});function g(){a(window).scroll(function(){var i=a(window).height(),r=a(window).width(),t=b.height()-20,s=b.width();b.css({left:((r/2)-(s/2))+"px",top:parseInt(a(document).scrollTop())+(i-t)/2+l})})}if(f.piro_scroll==true){g()}a(o).each(function(){var s=a(this).attr("title"),t=a(this).attr("rel").split("-"),i=a(this).attr("href");a(this).unbind();a(this).bind("click",function(u){piro_bg.css({opacity:f.bg_alpha});u.preventDefault();piro_next.add(piro_prev).hide().css("visibility","hidden");a(o).filter(".item").removeClass("item");a(this).addClass("item");r();if(a(this).is(".first")){piro_prev.hide();piro_next.show();piro_prev_fake.show().css({visibility:"hidden"})}else{piro_next.add(piro_prev).show();piro_next_fake.add(piro_prev_fake).hide()}if(a(this).is(".last")){piro_prev.show();piro_next_fake.show().css({visibility:"hidden"});piro_next.hide()}if(a(this).is(".pirobox")||a(this).is(".single_fix")){piro_next.add(piro_prev).hide()}if(a(this).is(".last")&&a(this).is(".first")){piro_next.add(piro_prev).hide()}});function r(){b.add(piro_bg).add(div_reg).add(piro_loader).show();function u(){a(".caption").remove();if(t[1]=="full"&&t[2]=="full"){t[2]=a(window).height()-70;t[1]=a(window).width()-55}var A=a(window).height();var z=a(window).width();piro_close.hide();div_reg.add(resize).animate({height:+(t[2])+"px",width:+(t[1])+"px"},f.piro_speed).css("visibility","visible");b.animate({height:+(t[2])+20+"px",width:+(t[1])+20+"px",left:((z/2)-((t[1])/2+10))+"px",top:parseInt(a(document).scrollTop())+(A-t[2])/2+l},f.piro_speed,function(){piro_next.add(piro_prev).add(piro_prev_fake).add(piro_next_fake).css("visibility","visible");piro_nav.show();piro_close.show()})}function w(){piro_nav.add(".caption").hide();if(s==""){a(".caption").remove()}else{a(m).appendTo(resize)}var z=new Image();z.onerror=function(){a(".caption").remove();z.src="http://www.pirolab.it/pirobox/js/error.jpg"};z.onload=function(){var F=z.height;var D=z.width;var H=a(window).height();var A=a(window).width();var G=z.height;var E=z.width;if(G+20>H||E+20>A){var C=(E+20)/A;var B=(G+20)/H;if(B>C){E=Math.round(z.width*(q/B));G=Math.round(z.height*(q/B))}else{E=Math.round(z.width*(q/C));G=Math.round(z.height*(q/C))}a(".zoomIn").add(".zoomOut").remove();a(".h_c_c").append('<a href="#" class="zoomIn" title="">zoomIn</a>');a(".zoomIn,.zoomOut").hide()}else{G=z.height;E=z.width;a(".zoomIn").add(".zoomOut").remove()}var H=a(window).height();var A=a(window).width();a(z).height(G).width(E).hide();a(".div_reg img").remove();a(".div_reg").html("");div_reg.append(z).show();a(z).addClass("immagine");if(f.piro_drag==true){a(".immagine,.h_b_c,.h_t_c").css("cursor","move");if(a.browser.msie){b.draggable({handle:".h_t_c,.h_b_c,.div_reg img"})}else{b.draggable({handle:".h_t_c,.h_b_c,.div_reg img",opacity:0.8})}}div_reg.add(resize).animate({height:G+"px",width:E+"px"},f.piro_speed);b.animate({height:(G+20)+"px",width:(E+20)+"px",left:((A/2)-((E+20)/2))+"px",top:parseInt(a(document).scrollTop())+(H-G)/2+l},f.piro_speed,function(){piro_loader.hide();var I=resize.width();a(".caption").css({width:I+"px"});a(".caption").html("<p>"+s+"</p>").hide();a(z).fadeIn(300,function(){if(z.src=="http://www.pirolab.it/pirobox/js/error.jpg"){}a(window).scroll(function(){if(a(".zoomOut").is(":visible")){a(z).animate({width:E,height:G,top:0,left:0},600,function(){a(".immagine").css("cursor","auto");a(z).draggable({disabled:true});a(".zoomIn").add(".zoomOut").remove();a(".h_c_c").append('<a href="#" class="zoomIn" title="">zoomIn</a>');a(".zoomIn").show()})}});a(".zoomOut").live("click",function(J){J.preventDefault();a(".immagine").css("cursor","auto");if(f.piro_drag==true){b.draggable({disabled:false})}a(z).draggable({disabled:true});a(".zoomIn").add(".zoomOut").remove();a(".h_c_c").append('<a href="#" class="zoomIn" title="">zoomIn</a>');a(".zoomIn").show();a(z).animate({width:E,height:G,top:0,left:0},600)});a(".zoomIn").live("click",function(J){J.preventDefault();a(".zoomIn").add(".zoomOut").remove();a(".h_c_c").append('<a href="#" class="zoomOut" title="">zoomOut</a>');a(".zoomOut").show();if(f.piro_drag==true){b.draggable({disabled:true})}a(z).draggable({disabled:false});a(z).animate({width:D,height:F,top:-(F-G)/2,left:-(D-E)/2},600,function(){var O=div_reg.offset();var L=(O.left+E)-D;var N=(O.top+G)-F;var K=O.left;var M=O.top;a(z).draggable({containment:[L,N,K,M],scrollSpeed:400});a(".immagine").css("cursor","move")})});a(".zoomIn").show();piro_close.show();a(".caption").slideDown(200);piro_next.add(piro_prev).add(piro_prev_fake).add(piro_next_fake).css("visibility","visible");piro_nav.show();resize.resize(function(){NimgW=z.width;NimgH=z.heigh;a(".caption").css({width:(NimgW)+"px"})})})})};z.src=i;piro_loader.click(function(){z.src="about:blank"})}switch(t[0]){case"iframe":a(".zoomIn").add(".zoomOut").remove();div_reg.html("").css("overflow","hidden");resize.css("overflow","hidden");piro_close.hide();u();div_reg.piroFadeIn(300,function(){div_reg.append('<iframe id="my_frame" class="my_frame" src="'+i+'" frameborder="0" allowtransparency="true" scrolling="auto" align="top"></iframe>');a(".my_frame").css({height:+(t[2])+"px",width:+(t[1])+"px"});piro_loader.hide()});break;case"content":a(".zoomIn").add(".zoomOut").remove();div_reg.html("").css("overflow","auto");resize.css("overflow","auto");a(".my_frame").remove();piro_close.hide();u();div_reg.piroFadeIn(300,function(){div_reg.load(i);piro_loader.hide()});break;case"inline":a(".zoomIn").add(".zoomOut").remove();div_reg.html("").css("overflow","auto");resize.css("overflow","auto");a(".my_frame").remove();piro_close.hide();u();div_reg.piroFadeIn(300,function(){a(i).clone(true).appendTo(div_reg).piroFadeIn(300);piro_loader.hide()});break;case"flash":a(".zoomIn").add(".zoomOut").remove();a(".my_frame").remove();div_reg.html("").css("overflow","hidden");u();var v=('<object  width="'+t[1]+'" height="'+t[2]+'"><param name="movie" value="'+i+'" /><param name="wmode" value="transparent" /><param name="allowFullScreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="menu" value="false" /><embed src="'+i+'" type="application/x-shockwave-flash" allowscriptaccess="always" menu="false" wmode="transparent" allowfullscreen="true" width="'+t[1]+'" height="'+t[2]+'"></embed></object>');div_reg.piroFadeIn(300,function(){a(v).appendTo(div_reg);piro_loader.hide()});break;case"gallery":div_reg.css("overflow","hidden");resize.css("overflow","hidden");a(".my_frame").remove();w();break;case"single":a(".my_frame").remove();div_reg.html("").css("overflow","hidden");resize.css("overflow","hidden");w();break}}});a(".immagine").live("click",function(){a(".caption").slideToggle(200)});function e(){if(a(".piro_close").is(":visible")){a(".zoomIn").add(".zoomOut").add(".my_frame").add(".caption").remove();b.add(div_reg).add(resize).stop();if(f.piro_drag==true){b.draggable({disabled:false})}var i=b;if(a.browser.msie){i=div_reg.add(piro_bg);a(".div_reg img").remove()}else{i=b.add(piro_bg)}i.piroFadeOut(200,function(){div_reg.html("");piro_loader.hide();piro_nav.hide();piro_bg.add(b).hide().css("visibility","visible")})}}piro_close.add(piro_loader).add(piro_bg).bind("click",function(i){i.preventDefault();e()})}})(jQuery);